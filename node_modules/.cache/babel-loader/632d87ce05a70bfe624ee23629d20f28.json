{"ast":null,"code":"import _slicedToArray from\"/home/sebastian/Pobrane/cryptowatch/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{Grid,Skeleton}from'@mui/material';import React,{useEffect,useState}from'react';import InfiniteScroll from'react-infinite-scroll-component';import{Subject,takeUntil}from'rxjs';import CoinsList from'../components/CoinsList';import CoinsListSkeleton from'../components/CoinsListSkeleton';import{retrieveCoinsAction}from'../store/coinsSlice';import{useAppDispatch,useAppSelector}from'../store/hooks';import{jsx as _jsx}from\"react/jsx-runtime\";function Coins(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),offset=_useState4[0],setOffset=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),hasMore=_useState6[0],setHasMore=_useState6[1];// used to unsubscribe from action calls (in combination with takeUntil)\nvar _useState7=useState(new Subject()),_useState8=_slicedToArray(_useState7,1),destroy$=_useState8[0];var coinsState=useAppSelector(function(state){return state.coins;});var selectedCurrencyRef=useAppSelector(function(state){return state.navbar.selectedCurrency;});var dispatch=useAppDispatch();var retrieveCoins=function retrieveCoins(offset,limit){if(!selectedCurrencyRef.uuid)return;return retrieveCoinsAction(coinsState,dispatch,{offset:offset,limit:limit,referenceCurrencyUuid:selectedCurrencyRef.uuid}).pipe(takeUntil(destroy$)).subscribe(function(res){if(offset===0){// reset loading for initial call\nsetLoading(false);}if(res.length<24){setHasMore(false);}if(res.length>0){// we don't need to increment the offset if there is no more data to fetch\nsetOffset(offset+limit);}});};useEffect(function(){if(offset===0){window.scroll({top:0});// scroll to top to prevent fetching next page\nretrieveCoins(0,24);}else{retrieveCoins(0,offset);}return function(){destroy$.next();destroy$.complete();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[selectedCurrencyRef]);if(loading)return/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:/*#__PURE__*/_jsx(CoinsListSkeleton,{size:24})});return/*#__PURE__*/_jsx(InfiniteScroll,{style:{overflow:\"inherit\"},next:function next(){return retrieveCoins(offset,24);},dataLength:coinsState.data.length,hasMore:hasMore,loader:/*#__PURE__*/_jsx(Skeleton,{width:\"60%\"}),scrollThreshold:\"20px\",children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:/*#__PURE__*/_jsx(CoinsList,{coins:coinsState.data,currencySign:selectedCurrencyRef.sign||selectedCurrencyRef.symbol})})});}export default Coins;","map":null,"metadata":{},"sourceType":"module"}