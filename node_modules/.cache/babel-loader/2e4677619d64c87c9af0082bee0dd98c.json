{"ast":null,"code":"import _slicedToArray from\"/home/sebastian/Pobrane/cryptowatch/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{ButtonBase,Grid,Skeleton,Stack,TextField}from'@mui/material';import{Box}from'@mui/system';import React,{useEffect,useRef,useState}from'react';import InfiniteScroll from'react-infinite-scroll-component';import{Subject,takeUntil}from'rxjs';import NewsList from'../components/NewsList';import{useAppDispatch,useAppSelector}from'../store/hooks';import{retrieveNewsAction}from'../store/newsSlice';import SearchIcon from'@mui/icons-material/Search';import NewsListSkeleton from'../components/NewsListSkeleton';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function News(){var _newsState$data;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),page=_useState4[0],setPage=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),hasMore=_useState6[0],setHasMore=_useState6[1];var _useState7=useState(new Subject()),_useState8=_slicedToArray(_useState7,1),destroy$=_useState8[0];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),search=_useState10[0],setSearch=_useState10[1];var searchRef=useRef(null);var newsState=useAppSelector(function(state){return state.news;});var dispatch=useAppDispatch();var retrieveNews=function retrieveNews(page,search){retrieveNewsAction(newsState,dispatch,{page:page,q:search}).pipe(takeUntil(destroy$)).subscribe(function(res){if(page===1){// reset loading for initial call\nsetLoading(false);}if(res.length<24){setHasMore(false);}if(res.length>0){// we don't need to increment the offset if there is no more data to fetch\nsetPage(page+1);}});};var handleSearch=function handleSearch(e){if(e.target)setSearch(e.target.value);};var handleSearchSubmit=function handleSearchSubmit(e){var _searchRef$current;if(!search)return;e===null||e===void 0?void 0:e.preventDefault();(_searchRef$current=searchRef.current)===null||_searchRef$current===void 0?void 0:_searchRef$current.blur();setLoading(true);window.scroll({top:0});// scroll to top to prevent fetching next page\nretrieveNews(1,search);};useEffect(function(){window.scroll({top:0});// scroll to top to prevent fetching next page\nretrieveNews(page,search);return function(){destroy$.next();destroy$.complete();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Box,{sx:{display:'flex',alignItems:'flex-end',mb:3,position:\"sticky\",top:0,paddingTop:\"70px\",paddingBottom:\"10px\",zIndex:10,bgcolor:'#f4f4f4'},children:/*#__PURE__*/_jsxs(Grid,{container:true,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:0,md:3}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,justifyContent:\"center\",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSearchSubmit,children:/*#__PURE__*/_jsxs(Stack,{direction:\"row\",children:[/*#__PURE__*/_jsx(TextField,{inputRef:searchRef,value:search,onBlur:function onBlur(){return handleSearchSubmit();},onChange:handleSearch,fullWidth:true,style:{background:\"white\"},id:\"outlined-basic\",label:\"Search\",variant:\"outlined\",size:\"small\"}),/*#__PURE__*/_jsx(ButtonBase,{onClick:function onClick(){return handleSearchSubmit();},children:/*#__PURE__*/_jsx(SearchIcon,{sx:{color:'action.active',ml:1,height:\"40px\",width:\"40px\"}})})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:0,md:3})]})}),loading?/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:/*#__PURE__*/_jsx(NewsListSkeleton,{size:24})}):/*#__PURE__*/_jsx(InfiniteScroll,{style:{overflow:\"inherit\"},scrollThreshold:\"20px\",next:function next(){return retrieveNews(page,search);},dataLength:(_newsState$data=newsState.data)===null||_newsState$data===void 0?void 0:_newsState$data.length,hasMore:hasMore,loader:/*#__PURE__*/_jsx(Skeleton,{width:\"60%\"}),children:/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:/*#__PURE__*/_jsx(NewsList,{news:newsState.data})})})]});}export default News;","map":null,"metadata":{},"sourceType":"module"}